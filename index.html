<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <title>SKYNNÂ® â€” Curated Skincare for South Africa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="SKYNNÂ® (formerly SkinLabs South Africa) curates dermatologist-informed guides, reviews, local deals and personalised routines for South Africans." />
  <link rel="canonical" href="https://skinlabs.co.za/" />

  <!-- Social -->
  <meta property="og:title" content="SKYNNÂ® â€” Curated Skincare for South Africa" />
  <meta property="og:description" content="Derm-informed guides, reviews, deals & personalised routines." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://skinlabs.co.za/" />
  <meta property="og:image" content="https://skinlabs.co.za/assets/og-skynn.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="theme-color" content="#0c0e10" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Material+Symbols+Outlined" rel="stylesheet" />

  <!-- AdSense loader (YOUR client ID; load once) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1237323355260727" crossorigin="anonymous"></script>

  <!-- JSON-LD: Organization + WebSite (SearchAction) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Organization",
    "name":"SKYNN",
    "url":"https://skinlabs.co.za",
    "logo":"https://skinlabs.co.za/assets/logo.png",
    "sameAs":[]
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebSite",
    "url":"https://skinlabs.co.za/",
    "name":"SKYNN",
    "potentialAction":{
      "@type":"SearchAction",
      "target":"https://skinlabs.co.za/?q={search_term_string}",
      "query-input":"required name=search_term_string"
    }
  }
  </script>

  <style>
    /* ---------------------- Design tokens ---------------------- */
    :root{
      --bg:#0c0e10; --panel:#111418; --muted:#8ca5b3; --brand:#6ee7d2; --brand2:#b3e5ff; --text:#eef3f5;
      --radius:14px; --shadow:0 10px 30px rgba(0,0,0,.35); --maxw:1080px; --gap:14px;
      --ad-desktop:728px; --ad-mobile:336px;
    }
    html[data-theme="light"]{
      --bg:#f6f7f9; --panel:#ffffff; --muted:#5c6b76; --brand:#0bb3a0; --brand2:#007aff1a; --text:#182026;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    img{max-width:100%;height:auto;display:block}
    a{color:var(--brand);text-decoration:none}
    button{font:inherit;cursor:pointer}
    .wrap{max-width:var(--maxw);margin:0 auto;padding:0 14px}
    .sr-only{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px)}

    /* ---------------------- Header / Nav ----------------------- */
    header{
      position:sticky;top:0;z-index:100;backdrop-filter:saturate(1.2) blur(8px);
      background:color-mix(in oklab, var(--bg) 90%, transparent);border-bottom:1px solid rgba(255,255,255,.08)
    }
    .nav{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px 0}
    .brand{display:flex;gap:10px;align-items:center;font-weight:800;letter-spacing:.3px;font-size:18px;white-space:nowrap}
    .brand-icon{display:inline-flex;align-items:center;justify-content:center;width:26px;height:26px;border-radius:8px;background:linear-gradient(135deg,var(--brand),var(--brand2));color:#052a23}
    .badge{font-size:12px;color:var(--muted)}
    .drawer{display:none}
    .hamburger,.theme-btn{
      display:inline-flex;gap:6px;align-items:center;background:var(--panel);border:1px solid rgba(0,0,0,.12);
      border-radius:10px;color:inherit;padding:8px 10px
    }
    .theme-btn .material-symbols-outlined{font-size:18px}
    .drawer.open{
      position:fixed;inset:56px 10px auto 10px;z-index:120;display:flex;flex-direction:column;gap:6px;background:var(--panel);
      border:1px solid rgba(0,0,0,.1);border-radius:12px;padding:10px;max-width:calc(var(--maxw) - 20px);width:calc(100% - 20px)
    }
    .drawer a{display:flex;align-items:center;gap:8px;color:inherit;padding:10px;border-radius:10px}
    .drawer a:hover{background:color-mix(in oklab, var(--panel) 85%, #0000)}
    .icon{font-family:"Material Symbols Outlined";font-weight:400;font-style:normal;font-size:18px;line-height:1}

    @media (min-width: 900px){
      .hamburger{display:none}
      .drawer{display:flex;position:static;flex-direction:row;gap:10px;background:transparent;border:none;padding:0}
      .drawer a{padding:8px 10px}
    }

    /* ---------------------- Panels & Layout -------------------- */
    .panel{
      background:linear-gradient(180deg,color-mix(in oklab, var(--panel) 100%, #0000), color-mix(in oklab, var(--panel) 95%, #0000) 60%);
      border:1px solid rgba(0,0,0,.08);border-radius:var(--radius);box-shadow:var(--shadow);min-width:0
    }
    .section-title{display:flex;align-items:center;justify-content:space-between;margin:6px 0 8px}
    .section-title h2{font-size:clamp(15px,2.4vw,20px);margin:0}
    .small{font-size:12px}.muted{color:var(--muted)}
    .divider{height:1px;background:rgba(0,0,0,.12);margin:10px 0}

    /* ---------------------- Hero ------------------------------- */
    .hero{display:grid;grid-template-columns:1fr;gap:var(--gap);padding:var(--gap) 0 8px}
    @media (min-width: 980px){ .hero{grid-template-columns:1.2fr .8fr} }
    .hero .panel{padding:14px}
    .hero h1{margin:.2rem 0 0;font-size:clamp(20px,5vw,34px);line-height:1.15}
    .hero p{color:var(--muted);font-size:clamp(14px,2.5vw,16px)}
    .searchbar{display:flex;gap:8px;margin-top:10px}
    .input{flex:1;padding:12px 14px;border-radius:10px;background:color-mix(in oklab, var(--bg) 92%, #0000);border:1px solid rgba(0,0,0,.12);color:inherit;min-width:0}
    .btn{padding:12px 14px;border-radius:10px;background:var(--brand);color:#07332b;border:none;font-weight:700}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .chip{padding:7px 10px;border-radius:999px;font-size:12px;color:#0b1415;background:var(--brand2);border:1px solid rgba(0,0,0,.12)}

    /* ---------------------- Sliders ---------------------------- */
    .slider{position:relative;overflow:hidden}
    .slides{display:flex;transition:transform .35s ease;will-change:transform}
    .slide{flex:0 0 auto;width:100%;padding:0 6px;box-sizing:border-box}
    .dots{display:flex;gap:6px;justify-content:center;margin:8px 0 2px}
    .dot{width:8px;height:8px;border-radius:999px;background:rgba(127,140,153,.45)}
    .dot.active{background:var(--brand)}
    .navbtn{
      position:absolute;top:50%;transform:translateY(-50%);z-index:5;border:none;background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.18);backdrop-filter:blur(6px);color:#fff;width:32px;height:32px;border-radius:10px;display:none;align-items:center;justify-content:center
    }
    .navbtn.prev{left:6px}.navbtn.next{right:6px}
    @media (min-width: 480px){ .navbtn{display:flex} }

    /* Per-view widths (responsive) */
    .slides[data-per="1"] .slide{width:100%}
    .slides[data-per="2"] .slide{width:50%}
    .slides[data-per="3"] .slide{width:33.3333%}

    /* Cards & lists */
    .card{padding:12px;border-radius:16px;background:linear-gradient(180deg,color-mix(in oklab, var(--panel) 95%, #0000), color-mix(in oklab, var(--panel) 92%, #0000) 70%);border:1px solid rgba(0,0,0,.08)}
    .card h3{margin:8px 0 4px;font-size:clamp(14px,2.4vw,18px)}
    .meta{font-size:12px;color:var(--muted)}
    .tags{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
    .tag{font-size:11px;border:1px solid rgba(0,0,0,.1);padding:3px 7px;border-radius:999px;color:color-mix(in oklab, var(--text) 85%, #000)}
    .rating{color:#ffdf6c}
    .cta{display:inline-flex;gap:6px;align-items:center;padding:8px 10px;border-radius:10px;background:color-mix(in oklab, var(--bg) 92%, #0000);border:1px solid rgba(0,0,0,.12);color:inherit}

    /* Grid below hero (ensures no overflow) */
    .grid{margin:10px 0 22px;display:grid;grid-template-columns:1fr;gap:var(--gap);min-width:0}
    @media (min-width: 980px){ .grid{grid-template-columns:2fr 1fr} }
    .sticky{position:static}
    @media (min-width:980px){ .sticky{position:sticky;top:76px} }

    /* Reviews */
    .review-list{display:grid;grid-template-columns:1fr;gap:12px}
    @media (min-width: 700px){ .review-list{grid-template-columns:repeat(2,1fr)} }
    .review{background:color-mix(in oklab, var(--panel) 92%, #0000);border:1px solid rgba(0,0,0,.08);border-radius:12px;padding:12px}

    /* Ads (clamped; no overflow) */
    .adbox{display:flex;justify-content:center;margin:10px 0}
    .ad-inner{width:100%;max-width:var(--ad-desktop)}
    .adsbygoogle{display:block;width:100%}
    @media (max-width: 600px){ .ad-inner{max-width:var(--ad-mobile)} }

    footer{margin:26px 0 60px;color:var(--muted)}

    /* ---------------------- Modals ----------------------------- */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;place-items:center;padding:14px;z-index:200}
    .modal .inner{background:var(--panel);border:1px solid rgba(0,0,0,.1);border-radius:16px;max-width:520px;width:calc(100% - 28px);padding:14px;color:inherit}

    /* ---------------------- FAB Chat --------------------------- */
    #fabChat{
      position:fixed;right:16px;bottom:calc(16px + env(safe-area-inset-bottom));z-index:150;border:none;
      background:linear-gradient(135deg,var(--brand),var(--brand2));color:#052a23;border-radius:50%;width:56px;height:56px;
      box-shadow:0 10px 25px rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center
    }
    #chatPanel{position:fixed;right:16px;bottom:86px;width:min(420px,calc(100% - 32px));z-index:160;display:none}
    #chatPanel .inner{background:var(--panel);border:1px solid rgba(0,0,0,.1);border-radius:16px;overflow:hidden}
    .chat-head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid rgba(0,0,0,.08)}
    .chat-body{max-height:55vh;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:8px}
    .msg{padding:10px;border-radius:12px;max-width:88%}
    .me{align-self:flex-end;background:color-mix(in oklab, var(--brand) 25%, var(--panel));border:1px solid rgba(0,0,0,.08)}
    .ai{align-self:flex-start;background:color-mix(in oklab, var(--panel) 95%, #0000);border:1px solid rgba(0,0,0,.08)}
    .chat-foot{display:flex;gap:8px;padding:10px;border-top:1px solid rgba(0,0,0,.08)}
    .chat-foot .input{flex:1}

    /* ---------------------- Locked state ----------------------- */
    .locked-note{padding:12px;border-radius:12px;background:color-mix(in oklab, var(--panel) 94%, #0000);border:1px dashed rgba(0,0,0,.2);text-align:center}
    .blurred{filter:blur(3px);pointer-events:none;user-select:none}
  </style>
</head>
<body>
<header>
  <div class="wrap nav">
    <div class="brand">
      <span class="brand-icon">S</span>
      <span>SKYNNÂ®</span>
      <span class="badge">formerly SkinLabs</span>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <button id="themeToggle" class="theme-btn" aria-label="Toggle theme"><span class="material-symbols-outlined">dark_mode</span></button>
      <button class="hamburger" id="navToggle" aria-label="Open menu"><span class="material-symbols-outlined">menu</span> Menu</button>
    </div>
    <nav class="drawer" id="drawer" aria-label="Primary">
      <a href="#explore"><span class="material-symbols-outlined">explore</span> Explore</a>
      <a href="#offers"><span class="material-symbols-outlined">local_mall</span> Deals</a>
      <a href="#reviews"><span class="material-symbols-outlined">reviews</span> Reviews</a>
      <a href="#signup" class="cta"><span class="material-symbols-outlined">person_add</span> Sign up</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <!-- Above-the-fold ad (clamped) -->
  <div class="panel adbox" style="padding:6px;margin-top:10px">
    <div class="ad-inner">
      <ins class="adsbygoogle" data-ad-client="ca-pub-1237323355260727" data-ad-slot="1111111111" data-ad-format="auto" data-full-width-responsive="true"></ins>
    </div>
    <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>
  </div>

  <section class="hero" id="hero">
    <div class="panel" style="padding:14px">
      <div class="badge">Launches <b>15 Aug 2025</b></div>
      <h1>Curated skincare for South Africa</h1>
      <p>Dermâ€‘informed guides, ingredient explainers, local brand roundups and smarter deals. Join to unlock all features, AI chat, and memberâ€‘only content.</p>

      <div class="searchbar" role="search" aria-label="Site search">
        <input id="q" class="input" placeholder="Search guides, ingredients, brandsâ€¦" aria-label="Search" />
        <button id="btnSearch" class="btn"><span class="material-symbols-outlined">search</span></button>
      </div>

      <div class="chips" id="chips" aria-label="Filters"></div>
      <div id="gateNote" class="locked-note" style="display:none;margin-top:10px">
        ðŸ”’ Sign up (R99/year) to read all curated content, save favourites, write reviews and use AI chat.
        <div style="margin-top:8px"><button class="btn" id="openSignupFromNote">Unlock access</button></div>
      </div>
    </div>

    <!-- Sponsored Offers slider -->
    <div class="panel" id="offersPanel" aria-label="Sponsored Offers" style="padding:14px">
      <div class="section-title"><h2>Sponsored Offers</h2><a class="small muted" href="#offers">See all</a></div>
      <div class="slider" id="offersSlider">
        <button class="navbtn prev" aria-label="Previous"><span class="material-symbols-outlined">chevron_left</span></button>
        <div class="slides" id="offersSlides" data-per="1"></div>
        <button class="navbtn next" aria-label="Next"><span class="material-symbols-outlined">chevron_right</span></button>
      </div>
      <div class="dots" id="offersDots"></div>

      <div class="divider"></div>
      <div class="adbox">
        <div class="ad-inner">
          <ins class="adsbygoogle" data-ad-client="ca-pub-1237323355260727" data-ad-slot="2222222222" data-ad-format="auto" data-full-width-responsive="true"></ins>
        </div>
      </div>
      <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>
    </div>
  </section>

  <!-- Explore -->
  <section id="explore" aria-label="Explore content">
    <div class="section-title"><h2>Latest Curations</h2><div class="small muted">Filter: <span id="activeFilter">All</span></div></div>

    <div class="slider" id="cardsSlider">
      <button class="navbtn prev" aria-label="Previous"><span class="material-symbols-outlined">chevron_left</span></button>
      <div id="cardsSlides" class="slides" data-per="1"></div>
      <button class="navbtn next" aria-label="Next"><span class="material-symbols-outlined">chevron_right</span></button>
    </div>
    <div class="dots" id="cardsDots"></div>

    <div class="grid" style="margin-top:var(--gap)">
      <div class="panel sticky" style="padding:12px;min-width:0">
        <div class="section-title"><h2>Top this week</h2></div>
        <div class="slider" id="topSlider">
          <button class="navbtn prev" aria-label="Previous"><span class="material-symbols-outlined">chevron_left</span></button>
          <div id="topSlides" class="slides" data-per="1"></div>
          <button class="navbtn next" aria-label="Next"><span class="material-symbols-outlined">chevron_right</span></button>
        </div>
        <div class="dots" id="topDots"></div>

        <div class="divider"></div>
        <!-- Newsletter (never overflows) -->
        <form id="newsletter" action="https://formspree.io/f/xeokkzle" method="POST" style="max-width:100%">
          <label class="small" for="email">Join our list (1â€“2 emails/month)</label>
          <div class="searchbar" style="margin-top:6px">
            <input type="email" id="email" name="email" class="input" placeholder="you@example.com" required />
            <button type="submit" class="btn"><span class="material-symbols-outlined">send</span></button>
          </div>
          <div class="small muted">By subscribing you agree to our Privacy Policy.</div>
        </form>

        <div class="divider"></div>
        <!-- Sidebar ad (clamped) -->
        <div class="adbox">
          <div class="ad-inner">
            <ins class="adsbygoogle" data-ad-client="ca-pub-1237323355260727" data-ad-slot="4444444444" data-ad-format="auto" data-full-width-responsive="true"></ins>
          </div>
        </div>
        <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>
      </div>
    </div>
  </section>

  <!-- Reviews (gated to signed-in) -->
  <section id="reviews" class="panel" style="padding:14px">
    <div class="section-title">
      <h2>Community Reviews</h2>
      <button id="btnAddReview" class="cta"><span class="material-symbols-outlined">rate_review</span> Write a review</button>
    </div>
    <div class="review-list" id="reviewList"></div>
  </section>

  <!-- Footer ad -->
  <div class="panel adbox" style="padding:6px;margin-top:10px">
    <div class="ad-inner" style="max-width:100%">
      <ins class="adsbygoogle" data-ad-client="ca-pub-1237323355260727" data-ad-slot="5555555555" data-ad-format="autorelaxed" data-full-width-responsive="true"></ins>
    </div>
    <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>
  </div>

  <footer class="wrap">
    <div class="divider"></div>
    <div class="small">Â© 2025 SKYNNÂ® â€” Curated skincare for South Africa. Not medical advice.</div>
  </footer>
</main>

<!-- Sign-up Modal (R99/year) -->
<div class="modal" id="signupModal" role="dialog" aria-modal="true" aria-labelledby="signupTitle">
  <div class="inner">
    <h3 id="signupTitle" style="margin:0 0 6px">Unlock SKYNNÂ® â€” R99/year</h3>
    <p class="small">Full access to guides, reviews, saved items and AI chat. Billing is annual. Cancel anytime.</p>
    <ul class="small">
      <li>Full content library</li>
      <li>Dermâ€‘informed AI chat (GPTâ€‘5 mini)</li>
      <li>Memberâ€‘only deals</li>
    </ul>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
      <button id="signupCancel" class="cta"><span class="material-symbols-outlined">close</span> Cancel</button>
      <button id="signupGo" class="btn"><span class="material-symbols-outlined">lock_open</span> Sign up (R99)</button>
    </div>
    <p class="small muted" style="margin-top:8px">After payment youâ€™ll be redirected back. Access is activated automatically.</p>
  </div>
</div>

<!-- Review Modal -->
<div class="modal" id="reviewModal" role="dialog" aria-modal="true" aria-labelledby="revTitle">
  <div class="inner">
    <h3 id="revTitle" style="margin:0 0 6px">Write a review</h3>
    <form id="reviewForm">
      <label class="small">Product/Guide</label>
      <input name="title" required placeholder="e.g., Vitamin C Guide" class="input" style="width:100%"/>

      <div style="display:flex;gap:10px;margin-top:8px;flex-wrap:wrap">
        <div style="flex:1;min-width:150px">
          <label class="small">Rating (1â€“5)</label>
          <input name="rating" type="number" min="1" max="5" required class="input" style="width:100%"/>
        </div>
        <div style="flex:1;min-width:150px">
          <label class="small">Skin type</label>
          <select name="skin" class="input" style="width:100%">
            <option>Normal</option><option>Dry</option><option>Oily</option><option>Combination</option><option>Sensitive</option>
          </select>
        </div>
      </div>
      <label class="small" style="margin-top:8px;display:block">Your review</label>
      <textarea name="body" required rows="4" class="input" style="width:100%"></textarea>

      <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:10px">
        <button type="button" id="revCancel" class="cta"><span class="material-symbols-outlined">close</span> Cancel</button>
        <button type="submit" class="cta" style="background:var(--brand);color:#07332b"><span class="material-symbols-outlined">save</span> Save</button>
      </div>
    </form>
  </div>
</div>

<!-- Floating AI Chat -->
<button id="fabChat" aria-label="Open AI chat"><span class="material-symbols-outlined">smart_toy</span></button>
<div id="chatPanel">
  <div class="inner">
    <div class="chat-head">
      <strong>SKYNN AI (Dermâ€‘informed)</strong>
      <button id="chatClose" class="hamburger" style="padding:6px 8px"><span class="material-symbols-outlined">close</span></button>
    </div>
    <div class="chat-body" id="chatBody">
      <div class="msg ai"><b>Hi!</b> I can suggest evidenceâ€‘based routines for your skin goals.
        <br/><span class="small muted">Not medical advice. For diagnosis, consult a professional.</span>
      </div>
    </div>
    <div class="chat-foot">
      <input id="chatInput" class="input" placeholder="Ask about acne, pigmentation, SPFâ€¦" />
      <button id="chatSend" class="btn"><span class="material-symbols-outlined">send</span></button>
    </div>
  </div>
</div>

<script>
/* ============================================================
   SKYNN Front-end App
   - Mobile-first, sliders, theme toggle
   - Gated membership (client-side) for GitHub Pages
   - AI Chat via a secure serverless proxy (instructions below)
   ============================================================

   IMPORTANT â€” AI Proxy Setup (do NOT put your OpenAI key in this file)
   --------------------------------------------------------------------
   1) Create a small serverless endpoint (e.g., Cloudflare Worker, Netlify Function, Vercel Function)
      that calls OpenAI's Responses API with model "gpt-5-mini". Recommended:
      - Responses API JS example: https://cookbook.openai.com/examples/responses_api/responses_example  
      - Models page: https://platform.openai.com/docs/models/gpt-5-mini  
      - GPTâ€‘5 developer intro: https://openai.com/index/introducing-gpt-5-for-developers/  
      - API reference index: https://platform.openai.com/docs/api-reference  
      - NEVER expose API keys client-side: https://help.openai.com/en/articles/5112595-best-practices-for-api-key  

   2) Example Cloudflare Worker (JavaScript) â€” paste into your Worker and set the OPENAI_API_KEY secret.
      ------------------------------------------------------------------
      import { OpenAI } from "npm:openai";
      export default {
        async fetch(req, env) {
          if (req.method !== "POST") return new Response("Method Not Allowed", {status:405});
          const body = await req.json();
          const messages = body.messages || [];
          const client = new OpenAI({ apiKey: env.OPENAI_API_KEY });
          // System prompt: derm-informed, SA context, safety-first
          const system = "You are SKYNN AI, providing evidence-based skincare guidance for South Africans. \
Avoid diagnosis, give dermatologist-level education, highlight red flags, and suggest seeing a professional when appropriate. \
Be concise, friendly, and specific. Include local product types without naming prescription medicines.";
          const resp = await client.responses.create({
            model: "gpt-5-mini",
            input: [
              { role: "system", content: system },
              ...messages
            ]
          });
          // Responses API returns a content array; return first text block
          const out = resp.output_text || (resp.output && resp.output[0]?.content[0]?.text) || "";
          return new Response(JSON.stringify({ output: out }), {
            headers: { "content-type": "application/json", "access-control-allow-origin": "*" }
          });
        }
      };

      // In Cloudflare: wrangler secret put OPENAI_API_KEY
      // In Netlify/Vercel Functions the code is similar; set env var OPENAI_API_KEY.

   3) Set your public proxy URL below in AI_PROXY_ENDPOINT. The browser will POST:
      { messages: [{role:'user', content:'...'}, ...] }
      and expects { output: "answer" } back.

   --------------------------------------------------------------------
   Membership & Paywall (client-side for GitHub Pages)
   --------------------------------------------------------------------
   â€¢ This demo uses localStorage to enforce membership in the browser
     (no server on GitHub Pages). For production-grade control, use a
     server / edge function to verify entitlements and gate content.
   â€¢ Integrate Stripe Checkout (or PayFast) and set CHECKOUT_URL below.
     After successful payment, redirect back with ?member=1.
*/

const PRICE_ZAR = 99;
const CHECKOUT_URL = "https://your-checkout.example/stripe-session"; // TODO: replace with Stripe/PayFast hosted checkout link
const AI_PROXY_ENDPOINT = "https://your-ai-proxy.example/chat";      // TODO: replace with your Worker/Function URL

/* --------------- Theme Toggle --------------- */
const themeBtn = document.getElementById('themeToggle');
const savedTheme = localStorage.getItem('skynn_theme');
if(savedTheme) document.documentElement.setAttribute('data-theme', savedTheme);
themeBtn.onclick = ()=>{
  const cur = document.documentElement.getAttribute('data-theme')||'dark';
  const next = cur==='dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', next);
  localStorage.setItem('skynn_theme', next);
  themeBtn.innerHTML = `<span class="material-symbols-outlined">${next==='dark'?'dark_mode':'light_mode'}</span>`;
};
themeBtn.dispatchEvent(new Event('click')); themeBtn.dispatchEvent(new Event('click')); // refresh icon on load

/* --------------- Nav Drawer --------------- */
const navToggle = document.getElementById('navToggle');
const drawer = document.getElementById('drawer');
navToggle?.addEventListener('click', ()=> drawer.classList.toggle('open'));

/* --------------- JSON Content --------------- */
const chipWrap = document.getElementById('chips');
const cardsSlides = document.getElementById('cardsSlides');
const cardsDots = document.getElementById('cardsDots');
const offersSlides = document.getElementById('offersSlides');
const offersDots = document.getElementById('offersDots');
const topSlides = document.getElementById('topSlides');
const topDots = document.getElementById('topDots');
const activeEl = document.getElementById('activeFilter');
const searchBtn = document.getElementById('btnSearch');
const qInput = document.getElementById('q');
const gateNote = document.getElementById('gateNote');
const openSignupFromNote = document.getElementById('openSignupFromNote');

const CATEGORIES = ["Guides","Ingredients","Routines","Reviews","Deals","Dermatologist Q&A","Local Brands"];
let active = "All", q="", CONTENT=[], OFFERS=[], shown=0;

/* --------------- Membership gating --------------- */
function memberUntil(){ return Number(localStorage.getItem('skynn_member_until')||0); }
function isMember(){ return Date.now() < memberUntil(); }
function setMember(years=1){
  const until = Date.now() + years*365*24*3600*1000;
  localStorage.setItem('skynn_member_until', String(until));
}
function requireMember(action){
  if(!isMember()){
    openSignup();
    return false;
  }
  return true;
}

function openSignup(){ document.getElementById('signupModal').style.display='grid'; }
function closeSignup(){ document.getElementById('signupModal').style.display='none'; }

/* --------------- Sign-up Modal wiring --------------- */
document.getElementById('signupCancel').onclick = closeSignup;
document.getElementById('signupGo').onclick = ()=>{
  // Redirect to your hosted checkout page.
  // After successful payment, configure your gateway to redirect back to:
  // https://skinlabs.co.za/?member=1 (or your GitHub Pages domain)
  window.location.href = CHECKOUT_URL;
};
openSignupFromNote.onclick = openSignup;

// Auto-activate membership if gateway redirected with ?member=1 (demo)
if(new URLSearchParams(location.search).get('member')==='1'){
  setMember(1);
  history.replaceState({}, "", location.pathname); // clean URL
}

/* --------------- Load JSON --------------- */
async function loadJSON(path){
  const res = await fetch(path, {cache:'no-store'});
  if(!res.ok) throw new Error('Failed to load '+path);
  return res.json();
}
async function initData(){
  try{
    [CONTENT, OFFERS] = await Promise.all([
      loadJSON('./data/content.json'),
      loadJSON('./data/offers.json')
    ]);
  }catch(e){
    // Fallback demo
    CONTENT = [
      {"type":"Guides","title":"Vitamin C: How to layer with Niacinamide","rating":4.8,"tags":["Brightening","Beginner"],"featured":true},
      {"type":"Ingredients","title":"Retinoids in SA: OTC vs Rx","rating":4.6,"tags":["Anti-ageing","Night"],"featured":true},
      {"type":"Routines","title":"Winter-to-Spring Routine (Budget)","rating":4.5,"tags":["Seasonal","Budget"],"featured":false},
      {"type":"Deals","title":"5 SA dupes for the viral HA serum","rating":4.0,"tags":["Dupe","Hydration"],"featured":false},
      {"type":"Local Brands","title":"SA mineral sunscreens roundup","rating":4.3,"tags":["Sunscreen","Local"],"featured":false}
    ];
    OFFERS = [
      {"brand":"Clicks","title":"3-for-2 Skincare","code":"","url":"#","blurb":"ClubCard deals.","tag":"Pharmacy"},
      {"brand":"Dis-Chem","title":"R100 OFF â‰¥ R600","code":"DERMA100","url":"#","blurb":"Derma shop promo.","tag":"Pharmacy"}
    ];
  }
}

/* --------------- SEO: ItemList JSON-LD from CONTENT --------------- */
function injectItemListSchema(items){
  try{
    const ld = {
      "@context":"https://schema.org",
      "@type":"ItemList",
      "itemListElement": items.slice(0,10).map((it, idx)=>({
        "@type":"ListItem",
        "position": idx+1,
        "name": it.title,
        "url": it.url || "https://skinlabs.co.za/"
      }))
    };
    const s = document.createElement('script');
    s.type="application/ld+json";
    s.textContent = JSON.stringify(ld);
    document.head.appendChild(s);
  }catch(e){}
}

/* --------------- Filters --------------- */
function makeChip(label){
  const b = document.createElement('button');
  b.className='chip'; b.textContent=label;
  b.onclick=()=>{ active=label; activeEl.textContent=active; shown=0; renderAll(); };
  return b;
}
function renderChips(){
  const chips = document.getElementById('chips'); chips.innerHTML='';
  chips.appendChild(makeChip("All"));
  CATEGORIES.forEach(c=> chips.appendChild(makeChip(c)));
}

/* --------------- Card / Offer Templates --------------- */
function cardHTML(item){
  return `
    <div class="card">
      <div class="meta">${item.type}${item.featured ? ' â€¢ <span class="chip">Featured</span>':''}</div>
      <h3>${item.title}</h3>
      <div class="rating">â˜… ${Number(item.rating||0).toFixed(1)}</div>
      <div class="tags">${(item.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('')}</div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
        <button class="cta small btnSave"><span class="material-symbols-outlined">grade</span> Save</button>
        ${item.url ? `<a class="small" href="${item.url}" target="_blank" rel="noopener">Read â†’</a>` : `<span class="small muted">Read â†’</span>`}
      </div>
    </div>`;
}
function offerHTML(o){
  return `
    <div class="card">
      <div class="meta">${o.tag || 'Offer'}</div>
      <h3 style="margin:4px 0">${o.brand||''}</h3>
      <div class="muted">${o.title||''}</div>
      <div class="divider"></div>
      <div class="small"><b>Code:</b> ${o.code || 'N/A'}</div>
      <div class="small muted">${o.blurb||''}</div>
      <div style="margin-top:10px"><a class="cta" href="${o.url||'#'}" target="_blank" rel="noopener"><span class="material-symbols-outlined">shopping_bag</span> Shop now</a></div>
    </div>`;
}

/* --------------- Slider Engine --------------- */
function initSlider(rootEl, dotsEl, {per=[1,2,3], breakpoints=[0,600,900], autoplayMs=0}={}){
  // per: slides per view across breakpoints
  const slidesEl = rootEl.querySelector('.slides');
  const prev = rootEl.querySelector('.prev') || rootEl.querySelector('.navbtn.prev');
  const next = rootEl.querySelector('.next') || rootEl.querySelector('.navbtn.next');
  let page=0, pages=1, timer=null;

  function currentPer(){
    const w = rootEl.clientWidth || window.innerWidth;
    let p = per[0];
    if(w>=breakpoints[1]) p = per[1]||p;
    if(w>=breakpoints[2]) p = per[2]||p;
    slidesEl.dataset.per = String(p);
    return p;
  }
  function recalc(){
    const children = slidesEl.children.length;
    const p = currentPer();
    pages = Math.max(1, Math.ceil(children / p));
    page = Math.min(page, pages-1);
    goto(page);
    renderDots();
  }
  function goto(n){
    page = Math.max(0, Math.min(n, pages-1));
    const perView = Number(slidesEl.dataset.per||1);
    const offset = page * (100); // page-based (each page = 100% width)
    slidesEl.style.transform = `translateX(-${offset}%)`;
    updateDots();
  }
  function renderDots(){
    if(!dotsEl) return;
    dotsEl.innerHTML='';
    for(let i=0;i<pages;i++){
      const d=document.createElement('button'); d.className='dot'; if(i===page) d.classList.add('active');
      d.onclick=()=>goto(i); dotsEl.appendChild(d);
    }
  }
  function updateDots(){
    if(!dotsEl) return;
    [...dotsEl.children].forEach((d,i)=> d.classList.toggle('active', i===page));
  }
  function startAuto(){
    if(!autoplayMs) return;
    stopAuto();
    timer = setInterval(()=> goto((page+1)%pages), autoplayMs);
  }
  function stopAuto(){ if(timer){ clearInterval(timer); timer=null; } }

  prev?.addEventListener('click', ()=>goto(page-1));
  next?.addEventListener('click', ()=>goto(page+1));
  rootEl.addEventListener('mouseenter', stopAuto);
  rootEl.addEventListener('mouseleave', startAuto);
  window.addEventListener('resize', recalc, {passive:true});

  recalc(); startAuto();
  return {recalc, goto, startAuto, stopAuto};
}

/* --------------- Renderers --------------- */
let cardsSliderCtrl=null, offersSliderCtrl=null, topSliderCtrl=null;

function renderAll(){
  const allowed = isMember();
  // Gate UI
  gateNote.style.display = allowed ? 'none' : 'block';

  // FILTER
  const list = CONTENT.filter(i =>
    (active==='All' || i.type===active) &&
    (q==='' || (i.title||'').toLowerCase().includes(q.toLowerCase()))
  );

  // Cards (gated: if not member, show locked preview only)
  cardsSlides.innerHTML = '';
  const renderItems = allowed ? list : list.slice(0, 3);
  renderItems.forEach(item=>{
    const wrap = document.createElement('div'); wrap.className='slide';
    wrap.innerHTML = cardHTML(item);
    // Save button hook (gated)
    wrap.querySelector('.btnSave').onclick = ()=> { if(!requireMember()) return; alert('Saved âœ“'); };
    cardsSlides.appendChild(wrap);
  });
  if(!allowed){
    const lock = document.createElement('div'); lock.className='slide';
    lock.innerHTML = `<div class="locked-note">Join to unlock the full library and member tools.</div>`;
    cardsSlides.appendChild(lock);
  }

  // Offers (also gated for details; still render titles if locked)
  offersSlides.innerHTML='';
  const offerItems = allowed ? OFFERS : OFFERS.slice(0,2);
  offerItems.forEach(o=>{
    const wrap = document.createElement('div'); wrap.className='slide';
    wrap.innerHTML = offerHTML(o);
    offersSlides.appendChild(wrap);
  });

  // Top this week (auto-rotate)
  topSlides.innerHTML='';
  [...CONTENT].sort((a,b)=>Number(b.rating||0)-Number(a.rating||0)).slice(0,6).forEach(x=>{
    const wrap = document.createElement('div'); wrap.className='slide';
    wrap.innerHTML = `<div class="card"><div class="meta">${x.type}</div><h3>${x.title}</h3><div class="rating">â˜… ${Number(x.rating||0).toFixed(1)}</div></div>`;
    topSlides.appendChild(wrap);
  });

  // Re-init sliders with responsive per-view
  if(cardsSliderCtrl){ cardsSliderCtrl.recalc(); } else {
    cardsSliderCtrl = initSlider(document.getElementById('cardsSlider'), cardsDots, { per:[1,2,3], breakpoints:[0,600,900] });
  }
  if(offersSliderCtrl){ offersSliderCtrl.recalc(); } else {
    offersSliderCtrl = initSlider(document.getElementById('offersSlider'), offersDots, { per:[1,2,3], breakpoints:[0,600,900] });
  }
  if(topSliderCtrl){ topSliderCtrl.recalc(); } else {
    topSliderCtrl = initSlider(document.getElementById('topSlider'), topDots, { per:[1,1,2], breakpoints:[0,600,900], autoplayMs: 4000 });
  }

  // Reviews list (gated)
  paintReviews(allowed);

  // Update SEO ItemList (first load or when filter changes)
  injectItemListSchema(list);
}

/* --------------- Search --------------- */
document.getElementById('btnSearch')?.addEventListener('click', ()=>{ q = qInput.value||''; renderAll(); });
qInput?.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ q = qInput.value||''; renderAll(); } });

/* --------------- Reviews (gated write/read) --------------- */
const modal = document.getElementById('reviewModal');
document.getElementById('btnAddReview').onclick = ()=>{ if(!requireMember()) return; modal.style.display='grid'; }
document.getElementById('revCancel').onclick = ()=>{ modal.style.display='none'; }

function paintReviews(allowed){
  const list = JSON.parse(localStorage.getItem('skynn_reviews')||'[]');
  const box = document.getElementById('reviewList');
  box.innerHTML = '';
  if(!allowed){
    box.innerHTML = `<div class="locked-note">Sign in to read community reviews.</div>`;
    return;
  }
  if(list.length===0){ box.innerHTML = '<div class="muted small">No reviews yet â€” be the first.</div>'; return; }
  list.slice(0,6).forEach(r=>{
    const el = document.createElement('div');
    el.className='review';
    el.innerHTML = `<b>${r.title}</b> <span class="small muted">â€¢ ${r.skin}</span><div class="rating">â˜… ${Number(r.rating).toFixed(1)}</div><div class="small">${r.body}</div>`;
    box.appendChild(el);
  });
}
document.getElementById('reviewForm').onsubmit = (e)=>{
  e.preventDefault();
  if(!requireMember()) return;
  const fd = new FormData(e.target);
  const item = Object.fromEntries(fd.entries());
  item.rating = Number(item.rating)||0;
  const ar = JSON.parse(localStorage.getItem('skynn_reviews')||'[]');
  ar.unshift({...item, ts:Date.now()});
  localStorage.setItem('skynn_reviews', JSON.stringify(ar));
  modal.style.display='none';
  paintReviews(true);
};

/* --------------- AI Chat (requires membership) --------------- */
const fab = document.getElementById('fabChat');
const chatPanel = document.getElementById('chatPanel');
const chatBody = document.getElementById('chatBody');
const chatInput = document.getElementById('chatInput');
document.getElementById('chatClose').onclick = ()=> chatPanel.style.display='none';

fab.onclick = ()=> { if(!requireMember()) return; chatPanel.style.display = chatPanel.style.display==='block' ? 'none' : 'block'; };
document.getElementById('chatSend').onclick = sendChat;
chatInput.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); sendChat(); } });

let convo = [{role:"system", content:"You are SKYNN AI. Provide evidence-based skincare guidance. Not medical advice. Ask clarifying questions before recommending routines. South Africa context."}];

async function sendChat(){
  if(!requireMember()) return;
  const text = chatInput.value.trim(); if(!text) return;
  chatInput.value='';
  chatBody.appendChild(msg('me', text));
  chatBody.scrollTop = chatBody.scrollHeight;

  // Post to your proxy which calls OpenAI Responses API (model: gpt-5-mini)
  try{
    const res = await fetch(AI_PROXY_ENDPOINT, {
      method:'POST',
      headers:{'content-type':'application/json'},
      body: JSON.stringify({ messages:[...convo, {role:'user', content:text}] })
    });
    const data = await res.json();
    const out = (data && (data.output || data.message || data.text)) || 'Sorry, I could not reply.';
    convo.push({role:'user', content:text}, {role:'assistant', content:out});
    chatBody.appendChild(msg('ai', out));
    chatBody.scrollTop = chatBody.scrollHeight;
  }catch(err){
    chatBody.appendChild(msg('ai', 'Network error. Please try again.'));
  }
}
function msg(cls, text){
  const d=document.createElement('div'); d.className=`msg ${cls}`; d.innerHTML = sanitize(text).replace(/\n/g,'<br/>'); return d;
}
function sanitize(s){ return s.replace(/[&<>]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c])); }

/* --------------- Boot --------------- */
function boot(){
  renderChips();
  initData().then(()=>{
    // If not a member, open signup on first visit
    if(!isMember()) openSignup();
    renderAll();
  });
}
boot();

/* --------------- Signup Modal close on outside click --------------- */
document.getElementById('signupModal').addEventListener('click', e=>{ if(e.target.id==='signupModal') closeSignup(); });

</script>
</body>
</html>